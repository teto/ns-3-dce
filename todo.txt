  BOUTIQUE VOO - WATERLOO
CHAUSSEE DE BRUXELLES 159
1410 WATERLOO

 b dce-netdb.cc:1095
 info breakpoints
 delete breakpoint <id>


dans ntp_filegen. filegen_open verifie si le fichier existe, le crée sinon etc...
aller voir ce qui doit etre créé:
Le systeme genere bcp de ce signal
teto@sirius:~/dce$ kill -l 14 ALRM

sys_linux.c:320:(get_version_specific_details) Fatal error : Cannot read information from uname, sorry

Uname renvoie un mauvais resultat. uname est membre de DceNodeContext qui est initialisé dans DceManagerHelper::Install par AggregateObject (CreateObject<DceNodeContext> ());
 

     @ams | matt1: sorry, setsid was removed from glibc in 2013 .. not sure why.
    @ams | matt1: it was part of the libbsd-compat stuff ..
    @ams | * The _BSD_SOURCE feature test macro no longer enables BSD interfaces that conflict with POSIX.  The libbsd-compat library (which was a dummy library that did nothing) has also been removed.
    @ams | in version 2.19
  @jsm28 | No, setsid was not removed.
  @jsm28 | It's defined via sysdeps/unix/syscalls.list and make-syscalls.sh.
metallic | https://www.gnu.org/software/libc/manual/html_node/Table-of-Input-Conversions.html#Table-of-Input-Conversions
metallic | Certainly %[ is a format conversion on its own
metallic | thanks pasky and ams :)
metallic | I thought that [ was a flag
    @ams | jsm28: ah, there it is hiding.
       * | ams finds a beer, and gives up for the day.
    @ams | cheers.

In kernel/include/linux/syscalls.h, I find asmlinkage long sys_setsid(void) and for the x86-64 	architecture I find "112→common→ setsid→ →   →   sys_setsid". I suppose I need to use the 112 as a key to find the actual implementation, any hint please ?
Ici on a le code généré par le script de la libc 
http://pastie.org/10244032#

matt1: that's a pretty complex subject, but if you
want to find the kernel implementation, typically a
good strategy is grepping for sys_callname, e.g.
sys_setsid
vmlinuz (~vmlinuz@unaffiliated/vmlinuz) a quitté
(Quit: WeeChat 0.4.3)
...or SYSCALL.*setsid ;-)
http://repo.or.cz/w/linux-2.6-linus.git/blob/0f57d867
87d8b1076ea8f9cbdddda2a46d534a27:/kernel/sys.c#l1066



sysdeps/unix/sysv/linux/x86_64/syscall.S

sudo ~/ntpoff/ntpd/ntpd -c /home/teto/dce/myscripts/ntp/ntpserver.conf -l ntp.log -n -D 4 > test.txt
echo "=======" |tee -a - - - - |cat files-0/var/log/26481/*|less
 
Le flag HAVE_TIMER_CREATE n'est pas de la partie sur ma machine

struct itimerval { 
        struct timeval it_interval;    /* timer interval */
        struct timeval it_value;       /* current value */
};

G bcp de "alarming: overflow" , c généré dans

Chercher dans le log
	DPRINTF(4, ("opening filegen (type=%d/stamp=%u) \"%s\"\n",
		    gen->type, stamp, fullname));

Dans ntp_parser.c  YYDPRINTF ((stderr, "Entering state %d\n", yystate));

PcapFileW
NetDevice::PacketType
Given a pointer to an object, look to see if that object has a name associated with it and, if so, return the name of the object otherwise return an empty string.

An object can be referred to in two ways. Either you can talk about it using its fully qualified path name, for example, "/Names/client/eth0" or you can refer to it by its name, in this case "eth0".

This method returns the name of the object, e.g., "eth0".


Avec la 1.12, netlinkok.pcap n'est pas correctement disséqué; il manque pas mal d'attributs

gcc -fpreprocessed -E model/libc-ns3.h | grep -E "DCE|NATIVE" | grep -Po '(?<=\().*(?=\))' 
readelf  --syms ./libfoo.so

14:08:20            matt1 | any hint on how a program to change linux clock speed (apart from ntpd). I would like to slow linux's clock down for testing                                        
14:10:42           maroon | matt1: adjtimex                                                       
14:11:18           mike_t | or ntptime      

utils/count_syscall.sh
README.md
man 2 link 
/home/teto/dce/build/myscripts/ntp/bin/dce-ntpd: relocation error: elf-cache/0/ntpd: symbol link, version GLIBC_2.2.5 not defined in file 0001.so.6 with link time reference


newpeer: 10.1.1.1->10.1.1.2 mode 3 vers 4 poll 6 10 flags 0x1 0x1 ttl 0 key 00000000

#0  0x00007ffff740810d in ns3::Object::Dispose (this=0x0) at ../src/core/model/object.cc:219
#1  0x00007ffff6129d23 in ns3::NodeListPriv::DoDispose (this=0x65b010) at ../src/network/model/node-list.cc:166
#2  0x00007ffff7409a07 in ns3::Object::DoDelete (this=0x65b010) at ../src/core/model/object.cc:403
#3  0x000000000040fc60 in ns3::ObjectDeleter::Delete (object=0x65b010) at /home/teto/ns3off/install/include/ns3-dev/ns3/object.h:450
#4  0x000000000041125c in ns3::SimpleRefCount<ns3::Object, ns3::ObjectBase, ns3::ObjectDeleter>::Unref (this=0x65b010)
    at /home/teto/ns3off/install/include/ns3-dev/ns3/simple-ref-count.h:115
#5  0x00007ffff612b4cb in ns3::Ptr<ns3::NodeListPriv>::~Ptr (this=0x7fffffffc880, __in_chrg=<optimized out>) at ./ns3/ptr.h:756
#6  0x00007ffff612ae22 in ns3::NodeList::GetNode (n=1) at ../src/network/model/node-list.cc:243
#7  0x00007ffff7a92ec0 in ns3::UtilsGetNode (nodeId=1) at ../model/utils.cc:194
#8  0x00007ffff7a935a9 in ns3::UtilsNodeTime (nodeId=1) at ../model/utils.cc:223
#9  0x00007ffff7ae9297 in dce_clock_gettime (c=0, tp=0x7fffffffcaf0) at ../model/dce-time.cc:73
#10 0x00007ffff48837d2 in clock_gettime (a0=0, a1=0x7fffffffcaf0) at ../model/libc-ns3.h:345
#11 0x00007ffff34a6786 in get_ostime (tsp=0x7fffffffcaf0) at systime.c:135
#12 0x00007ffff34a6845 in get_systime (now=0x7fffffffcb60) at systime.c:180
#13 0x00007ffff3476fe3 in record_proto_stats (str=0x7fffffffcc20 "0.0.0.0 c02d 0d kern kernel time sync disabled") at ntp_util.c:776
#14 0x00007ffff3451bd6 in report_event (err=13, peer=0x0, str=0x7ffff34df360 "kernel time sync disabled") at ntp_control.c:4737
#15 0x00007ffff345fd67 in stop_kern_loop () at ntp_loopfilter.c:1167
#16 0x00007ffff7adc01f in dce___cxa_finalize (d=0x0) at ../model/dce-cxa.cc:43
#17 0x00007ffff7afa28a in ns3::TaskManager::DoDispose (this=0x660960) at ../model/task-manager.cc:149
#18 0x00007ffff7408159 in ns3::Object::Dispose (this=0x65b230) at ../src/core/model/object.cc:225
#19 0x00007ffff6129d23 in ns3::NodeListPriv::DoDispose (this=0x65b010) at ../src/network/model/node-list.cc:166
#20 0x00007ffff7409a07 in ns3::Object::DoDelete (this=0x65b010) at ../src/core/model/object.cc:403
#21 0x000000000040fc60 in ns3::ObjectDeleter::Delete (object=0x65b010) at /home/teto/ns3off/install/include/ns3-dev/ns3/object.h:450
#22 0x000000000041125c in ns3::SimpleRefCount<ns3::Object, ns3::ObjectBase, ns3::ObjectDeleter>::Unref (this=0x65b010)
    at /home/teto/ns3off/install/include/ns3-dev/ns3/simple-ref-count.h:115
#23 0x00007ffff612b4cb in ns3::Ptr<ns3::NodeListPriv>::~Ptr (this=0x7fffffffd020, __in_chrg=<optimized out>) at ./ns3/ptr.h:756
#24 0x00007ffff612ae22 in ns3::NodeList::GetNode (n=0) at ../src/network/model/node-list.cc:243
#25 0x00007ffff7a92ec0 in ns3::UtilsGetNode (nodeId=0) at ../model/utils.cc:194
#26 0x00007ffff7a935a9 in ns3::UtilsNodeTime (nodeId=0) at ../model/utils.cc:223
#27 0x00007ffff7ae9297 in dce_clock_gettime (c=0, tp=0x7fffffffd290) at ../model/dce-time.cc:73
#28 0x00007ffff48837d2 in clock_gettime (a0=0, a1=0x7fffffffd290) at ../model/libc-ns3.h:345
#29 0x00007ffff34a6786 in get_ostime (tsp=0x7fffffffd290) at systime.c:135
#30 0x00007ffff34a6845 in get_systime (now=0x7fffffffd300) at systime.c:180
#31 0x00007ffff3476fe3 in record_proto_stats (str=0x7fffffffd3c0 "0.0.0.0 c01d 0d kern kernel time sync disabled") at ntp_util.c:776
#32 0x00007ffff3451bd6 in report_event (err=13, peer=0x0, str=0x7ffff34df360 "kernel time sync disabled") at ntp_control.c:4737
#33 0x00007ffff345fd67 in stop_kern_loop () at ntp_loopfilter.c:1167
#34 0x00007ffff7adc01f in dce___cxa_finalize (d=0x0) at ../model/dce-cxa.cc:43
#35 0x00007ffff7afa28a in ns3::TaskManager::DoDispose (this=0x660120) at ../model/task-manager.cc:149
#36 0x00007ffff7408159 in ns3::Object::Dispose (this=0x65af70) at ../src/core/model/object.cc:225
#37 0x00007ffff6129d23 in ns3::NodeListPriv::DoDispose (this=0x65b010) at ../src/network/model/node-list.cc:166
#38 0x00007ffff7409a07 in ns3::Object::DoDelete (this=0x65b010) at ../src/core/model/object.cc:403
#39 0x000000000040fc60 in ns3::ObjectDeleter::Delete (object=0x65b010) at /home/teto/ns3off/install/include/ns3-dev/ns3/object.h:450
#40 0x000000000041125c in ns3::SimpleRefCount<ns3::Object, ns3::ObjectBase, ns3::ObjectDeleter>::Unref (this=0x65b010)
    at /home/teto/ns3off/install/include/ns3-dev/ns3/simple-ref-count.h:115
#41 0x00007ffff612b5af in ns3::Ptr<ns3::NodeListPriv>::operator= (this=0x7ffff64564a8 <ns3::NodeListPriv::DoGet()::ptr>, o=...)
    at ./ns3/ptr.h:770
#42 0x00007ffff612976d in ns3::NodeListPriv::Delete () at ../src/network/model/node-list.cc:146
#43 0x00007ffff73eb468 in ns3::EventFunctionImpl0::Notify (this=0x65ae60) at ../src/core/model/make-event.cc:53
#44 0x00007ffff73deb7b in ns3::EventImpl::Invoke (this=0x65ae60) at ../src/core/model/event-impl.cc:51
#45 0x00007ffff73e303a in ns3::DefaultSimulatorImpl::Destroy (this=0x65b050) at ../src/core/model/default-simulator-impl.cc:99
#46 0x00007ffff73df444 in ns3::Simulator::Destroy () at ../src/core/model/simulator.cc:180
#47 0x000000000040ed25 in main (argc=1, argv=0x7fffffffe088) at ../myscripts/ntp/dce-ntpd.cc:251



stub mlockall; not really implemented

last_ttl = 0
addr_refid = 0202010a
num_mcast = 0
received = 0
sent = 0
notsent = 0
ifindex = 2
peercnt = 0
phase = 1
updating interface #2: fd=7, bfd=-1, name=ns3-device 2, flags=0x9, ifindex=2, sin=10.1.2.2, bcast=10.1.2.3, mask=255.255.255.252, Enabled: new - created
Dumping interface: 0x7fbe6d2cb5b8
fd = 7
bfd = -1
sin = 10.1.2.2,
0200007b 0a010202 00000000 00000000 00000000 00000000 00000000 
bcast = 10.1.2.3,
0200007b 0a010203 00000000 00000000 00000000 00000000 00000000 
mask = 255.255.255.252,
0200007b fffffffc 00000000 00000000 00000000 00000000 00000000 
name = ns3-device 2
flags = 0x00000009
last_ttl = 0
addr_refid = 0202010a
num_mcast = 0
received = 0
sent = 0
notsent = 0
ifindex = 2
peercnt = 0
phase = 1
setting SO_REUSEADDR on ns3-device 1@10.1.1.2 to off
setting SO_REUSEADDR on ns3-device 2@10.1.2.2 to off
create_sockets: Total interfaces = 3
 1 Jan 00:00:00 ntpd[2022]: Listening on routing socket on fd #8 for interface updates
io_open_sockets: maxactivefd 8
findexistingpeer_addr(127.127.1.0:123, NULL, 3, 0x1)
newpeer(127.127.1.0): local interface currently not bound
key_expire: at 0 associd 16467
peer_clear: at 0 next 1 associd 16467 refid INIT
event at 0 LOCAL(0) 8011 81 mobilize assoc 16467
newpeer: <null>->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000
getnetnum given 127.127.1.0, got 127.127.1.0
findexistingpeer_addr(127.127.1.0:123, NULL, -1, 0x0)
127.127.1.0:123 127.127.1.0:123 -1 3 0x0 0x1 found.
loop_config: item 1 freq 0.000000
event at 0 0.0.0.0 c01d 0d kern kernel time sync enabled
blocking_getaddrinfo given node ntp.ubuntu.com serv ntp fam 0 flags 0
event at 0 0.0.0.0 c012 02 freq_set kernel 0.000 PPM
local_clock: mu 0 state 1 poll 3 count 0
event at 0 0.0.0.0 c011 01 freq_not_set
event at 0 0.0.0.0 c016 06 restart
alarming: normal
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow



create_sockets: Total interfaces = 3
 1 Jan 00:00:00 ntpd[2022]: Listening on routing socket on fd #8 for interface updates
io_open_sockets: maxactivefd 8
findexistingpeer_addr(127.127.1.0:123, NULL, 3, 0x1)
newpeer(127.127.1.0): local interface currently not bound
key_expire: at 0 associd 16467
peer_clear: at 0 next 1 associd 16467 refid INIT
event at 0 LOCAL(0) 8011 81 mobilize assoc 16467
newpeer: <null>->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000
getnetnum given 127.127.1.0, got 127.127.1.0
findexistingpeer_addr(127.127.1.0:123, NULL, -1, 0x0)
127.127.1.0:123 127.127.1.0:123 -1 3 0x0 0x1 found.
loop_config: item 1 freq 0.000000
event at 0 0.0.0.0 c01d 0d kern kernel time sync enabled
blocking_getaddrinfo given node ntp.ubuntu.com serv ntp fam 0 flags 0
event at 0 0.0.0.0 c012 02 freq_set kernel 0.000 PPM
local_clock: mu 0 state 1 poll 3 count 0
event at 0 0.0.0.0 c011 01 freq_not_set
event at 0 0.0.0.0 c016 06 restart
alarming: normal
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow
alarming: overflow

Output sur la machien hôte
create_sockets: Total interfaces = 6
13 Jun 00:23:10 ntpd[16938]: Listening on routing socket on fd #22 for interface updates
io_open_sockets: maxactivefd 22
event at 0 0.0.0.0 c016 06 restart
loop_config: item 2 freq 1000000000.000000
event at 0 0.0.0.0 c012 02 freq_set kernel 0.000 PPM
local_clock: mu 0 state 1 poll 3 count 0
event at 0 0.0.0.0 c011 01 freq_not_set
auth_agekeys: at 1 keys 0 expired 0





sudo ntpd -c ~/dotfiles/ntp.conf -l ntp.log -p ntp.pid -f ntp.drift -n -D 3                    23:57:08   clock_support 
[sudo] password for teto: 
ntpd 4.2.6p5@1.2349-o Mon Apr 13 13:39:46 UTC 2015 (1)
15 Jun 23:57:27 ntpd[9126]: logging to file ntp.log
15 Jun 23:57:27 ntpd[9126]: set_process_priority: Leave priority alone: priority_done is <2>
15 Jun 23:57:27 ntpd[9126]: proto: precision = 0.107 usec
loop_config: item 1 freq 0.000000
event at 0 0.0.0.0 c01d 0d kern kernel time sync enabled
Finished Parsing!!
create_sockets(123)
15 Jun 23:57:27 ntpd[9126]: ntp_io: estimated max descriptors: 1024, initial socket boundary: 16
15 Jun 23:57:27 ntpd[9126]: Listen and drop on 0 v4wildcard 0.0.0.0 UDP 123
created interface #0: fd=16, bfd=-1, name=v4wildcard, flags=0x89, ifindex=0, sin=0.0.0.0, bcast=0.0.0.0, mask=255.255.255.255, Disabled:
15 Jun 23:57:27 ntpd[9126]: Listen and drop on 1 v6wildcard :: UDP 123
created interface #1: fd=17, bfd=-1, name=v6wildcard, flags=0x81, ifindex=0, sin=::, Disabled:
update_interfaces(123)
create_interface(127.0.0.1#123)
15 Jun 23:57:27 ntpd[9126]: Listen normally on 2 lo 127.0.0.1 UDP 123
restrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00003000 flags 00000001
created interface #2: fd=18, bfd=-1, name=lo, flags=0x5, ifindex=0, sin=127.0.0.1, mask=255.0.0.0, Enabled:
updating interface #2: fd=18, bfd=-1, name=lo, flags=0x5, ifindex=0, sin=127.0.0.1, mask=255.0.0.0, Enabled: new - created
create_interface(192.168.1.231#123)
15 Jun 23:57:27 ntpd[9126]: Listen normally on 3 eth0 192.168.1.231 UDP 123
restrict: op 1 addr 192.168.1.231 mask 255.255.255.255 mflags 00003000 flags 00000001
created interface #3: fd=19, bfd=-1, name=eth0, flags=0x19, ifindex=0, sin=192.168.1.231, bcast=192.168.1.255, mask=255.255.255.0, Enabled:
updating interface #3: fd=19, bfd=-1, name=eth0, flags=0x19, ifindex=0, sin=192.168.1.231, bcast=192.168.1.255, mask=255.255.255.0, Enabled: new - created
create_interface(::1#123)
15 Jun 23:57:27 ntpd[9126]: Listen normally on 4 lo ::1 UDP 123
restrict: op 1 addr ::1 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00003000 flags 00000001
created interface #4: fd=20, bfd=-1, name=lo, flags=0x5, ifindex=1, sin=::1, Enabled:
updating interface #4: fd=20, bfd=-1, name=lo, flags=0x5, ifindex=1, sin=::1, Enabled: new - created
create_interface(fe80::ae9e:17ff:fe83:50e9#123)
15 Jun 23:57:27 ntpd[9126]: Listen normally on 5 eth0 fe80::ae9e:17ff:fe83:50e9 UDP 123
restrict: op 1 addr fe80::ae9e:17ff:fe83:50e9 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00003000 flags 00000001
created interface #5: fd=21, bfd=-1, name=eth0, flags=0x11, ifindex=2, sin=fe80::ae9e:17ff:fe83:50e9, Enabled:
updating interface #5: fd=21, bfd=-1, name=eth0, flags=0x11, ifindex=2, sin=fe80::ae9e:17ff:fe83:50e9, Enabled: new - created
15 Jun 23:57:27 ntpd[9126]: peers refreshed
create_sockets: Total interfaces = 6
15 Jun 23:57:27 ntpd[9126]: Listening on routing socket on fd #22 for interface updates
io_open_sockets: maxactivefd 22
auth_setkey: key 65535 type 4 len 16 1cbe42b26169495f10b84b2656765df7
getnetnum given 0.0.0.0, got 0.0.0.0
getnetnum given 0.0.0.0, got 0.0.0.0
restrict: op 1 addr 0.0.0.0 mask 0.0.0.0 mflags 00000000 flags 000005d0
getnetnum given ::, got ::
getnetnum given ::, got ::
restrict: op 1 addr :: mask :: mflags 00000000 flags 000005d0
getnetnum given 127.0.0.1, got 127.0.0.1
restrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00000000 flags 00000000
getnetnum given ::1, got ::1
restrict: op 1 addr ::1 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00000000 flags 00000000
newpeer: cast flags: 0x1 for address: 127.127.1.0
newpeer: using fd 18 and our addr 127.0.0.1
key_expire: at 0 associd 32910
peer_clear: at 0 next 1 associd 32910 refid INIT
event at 0 LOCAL(0) 8011 81 mobilize assoc 32910
newpeer: 127.0.0.1->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000
getnetnum given 127.127.1.0, got 127.127.1.0
event at 0 0.0.0.0 c016 06 restart
loop_config: item 2 freq 1000000000.000000
event at 0 0.0.0.0 c012 02 freq_set kernel 0.000 PPM
local_clock: mu 0 state 1 poll 3 count 0
event at 0 0.0.0.0 c011 01 freq_not_set
refclock_transmit: at 1 127.127.1.0
refclock_receive: at 1 127.127.1.0
event at 1 LOCAL(0) 8024 84 reachable
refclock_sample: n 1 offset 0.000000 disp 0.010000 jitter 0.000000
filegen  2 3643394248 0 3643315200
clock_filter: n 1 off 0.000000 del 0.000000 dsp 7.937500 jit 0.000000
select: survivor 127.127.1.0 0.000000
select: combine offset 0.000000000 jitter 0.000000000
event at 1 LOCAL(0) 903a 8a sys_peer
poll_update: at 1 127.127.1.0 poll 6 burst 0 retry 0 head 0 early 2 next 64
clock_update: at 1 sample 1 associd 32910
local_clock: mu 1 state 4 poll 6 count 0
event at 1 0.0.0.0 c514 04 freq_mode
filegen  2 3643394248 0 3643315200
local_clock: offset 0.000000000 jit 0.000000119 freq 0.000 stab 0.000 poll 6
poll_update: at 1 127.127.1.0 poll 6 burst 0 retry 0 head 0 early 2 next 64
auth_agekeys: at 1 keys 1 expired 0
timer: interface update
update_interfaces(123)
write_stats: wander 0.000000 thresh 0.000000, freq 0.000000
read_network_packet: fd=18 length 48 from 127.0.0.1
receive: at 45 127.0.0.1<-127.0.0.1 flags 5 restrict 000
receive: at 45 127.0.0.1<-127.0.0.1 mode 3 len 48
sendpkt(18, dst=127.0.0.1, src=127.0.0.1, ttl=0, len=48)
transmit: at 45 127.0.0.1->127.0.0.1 mode 4 len 48
read_network_packet: fd=18 length 48 from 127.0.0.1
receive: at 46 127.0.0.1<-127.0.0.1 flags 5 restrict 000
restrict: interval 1 headway 8 limit 64
receive: at 46 127.0.0.1<-127.0.0.1 mode 3 len 48
sendpkt(18, dst=127.0.0.1, src=127.0.0.1, ttl=0, len=48)
transmit: at 46 127.0.0.1->127.0.0.1 mode 4 len 48
^[[6~read_network_packet: fd=18 length 48 from 127.0.0.1
receive: at 48 127.0.0.1<-127.0.0.1 flags 5 restrict 000
restrict: interval 2 headway 12 limit 64
receive: at 48 127.0.0.1<-127.0.0.1 mode 3 len 48
sendpkt(18, dst=127.0.0.1, src=127.0.0.1, ttl=0, len=48)
transmit: at 48 127.0.0.1->127.0.0.1 mode 4 len 48
read_network_packet: fd=18 length 48 from 127.0.0.1
receive: at 52 127.0.0.1<-127.0.0.1 flags 5 restrict 000
restrict: interval 4 headway 14 limit 64
receive: at 52 127.0.0.1<-127.0.0.1 mode 3 len 48
sendpkt(18, dst=127.0.0.1, src=127.0.0.1, ttl=0, len=48)
transmit: at 52 127.0.0.1->127.0.0.1 mode 4 len 48



This week has delivered the following:
 - fixed the netlink bug described in [1] (to help me in that task, I extended wireshark's netlink dissector[0])
 - About the libgcrypt problem, it doesn't provide pkg-config so I found a waf alternative that can check for its presence without it. Test nearly finished.
 - Rather than sending patches dependant on one another, I've pushed the clock support code for dce [2] and ns3 [3]. This seems to launch ntpd but I've no idea if it works
 I've not had the time to look at mptcp dce as I had (ambitiously xD) proposed 

For the upcoming week:
 - prepare the mptcp crypto code for the 20 of june review
 - understand if clock synchronization happens or not and fix what needs to be fixed.

[0] https://code.wireshark.org/review/#/c/8916/1/epan/dissectors/packet-netlink.c
[1] https://github.com/direct-code-execution/ns-3-dce/issues/2
[2] https://github.com/teto/ns-3-dce/commits/clock_support
[3] https://github.com/teto/ns-3-dev-git/commits/clock_support


/* */
isc_interfaceiter_create

ntpd 4.2.8p3-RC1-o Tue Jun  9 21:39:44 UTC 2015 (3): Starting
Command line: ntpd -c /tmp/ntp.conf -ddddd
Cannot set RLIMIT_MEMLOCK: Operation not permitted
set_process_priority: Leave priority alone: priority_done is <2>
proto: precision = 1.000 usec (-20)
Listen and drop on 0 v4wildcard 0.0.0.0:123
./../lib/isc/unix/ifiter_getifaddrs.c:168: INSIST(ifa->ifa_name != ((void *)0)) failed
exiting (due to assertion failure)


NotifyIfLinkMessage ne génère pas un numéro de séquence correct !

NodeContainer::GetGlobal ();
EnablePcapInternal doit etre implémenté par les Device, par exemple regarder à FdNetDevice
PcapHelper::HookDefaultSink

supergrass - Alright
EMF - Unbelievable

You can use rtmon to 

pcap-file.h

ARPHRD_NETLINK	824

PcapFile
0x12 => 18 => RTM_GETLINK

=== Partie sur wireshark ===
hfi_netlink_hdr_type

Matt: getifaddr attempt #0
alarming: initializing TRUE
Matt: getifaddr failed with errorno=22

1.6s 1 ProcessUtils:UtilsDoSignal(): [DEBUG] deliver signal=14
1.6s 1 SimuFd:dce_write(0x1f5be10, 1, 1, 0x7f944c63e035, 28)
1.6s 1 UnixFileFd:Write(0x1ef66e0, 0x1f5be10, 0x7f944c63e035, 28)
1.6s 1 DceNetlinkSocket:RecvFrom(0x2002b10, 4096, 0, 00-00-00)
1.6s 1 DceNetlinkSocket:Recv(0x2002b10, 4096, 0)
1.6s 1 UnixDatagramSocketFd:DoRecvmsg(): [ERROR] Empty packet
1.6s 1 DceNetlinkSocket:GetErrno()
1.6s 1 DceNetdb:netlink_request(): [WARN ] read_len=-1 < 0
1.6s 1 DceNetdb:dce_getifaddrs(): [WARN ] Could not RTM_GETLINK.


Pb c que la paquet recu est vide
  if (m_dataReceiveQueue.empty ())

findexistingpeer_addr(127.127.1.0:123, NULL, 3, 0x1)
newpeer(127.127.1.0): local interface currently not bound
key_expire: at 0 associd 16467
peer_clear: at 0 next 1 associd 16467 refid INIT
event at 0 LOCAL(0) 8011 81 mobilize assoc 16467
newpeer: <null>->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000


Stack now 0 54 207
Cleanup: popping token $end ()
Cleanup: popping nterm configuration ()
 1 Jan 00:00:01 ntpd[2022]: ./../lib/isc/unix/ifiter_getifaddrs.c:99: unexpected error:
 1 Jan 00:00:01 ntpd[2022]: getting interface addresses: getifaddrs: Invalid argument
 1 Jan 00:00:01 ntp_intres[2022]: receive_blocking_req_internal: pipe read No such file or directory

Apparemment NTP appelle plusieurs fois getifaddr

getifaddr genere un paquet de type RTM_GETLINK envoie un paquet de type:
netlink-route.nltype == 18
Le type 16 correspond à la réponse ("Create network interface").
Apparemment les adresses renvoyées par netlink ont pas l'air correct et quand tu regards

Pour de la doc sur les messages
http://www.infradead.org/~tgr/libnl/doc/route.html

"All netlink link messages share a common header (struct ifinfomsg) which is appended after the netlink header (struct nlmsghdr)"


Pour voir les headers des pcap
http://www.kroosec.com/2012/10/a-look-at-pcap-file-format.html


Pour dce_getifaddr on pourrait se passer de Netlink si l'on detecte qu'il s'agit d'une stack ns3 ?
repo ntp
DCE agrège au Node une SocketFdFactory qui va dépendre du type de stack à priori. On peut récupérer leur type pour
justement les comparer: Ns3SocketFdFactory pour ns3

Le NotifyNewAggregate. est appelé quand un object vient d'être agrégé. 
Cela pourrait être utilisé lorsque l'on agrège une horloge (pour MAJ l'offset)

Check that the netlink messages are well received
RTM_GETLINK

./waf --run "test-runner" if you want to launch tests

./waf --run "test-runner --verbose --test-name=netlink-socket"
NS_LOG="*" ./waf --run "test-runner --verbose --test-name=netlink-socket" > nl_xp.txt 2>&1

J'ai quand mm "DceNetlinkSocket:BuildInterfaceInfoDumpMessage" qui est appelé

Quand on a un RTM_GETLINK , la socket doit renoyver BuildInterfaceInfoDumpMessages

improv
https://www.nsnam.org/developers/roadmap/

$ i3-msg mark irssi
$ i3-msg '[con_mark="irssi"] focus'
$ i3-msg unmark irssi


But when the Alt key is used in a key combination (that is by actually pressing Alt+x), its release will not be registered by i3 and the mode "foo" will remain active until pressing and releasing key 108 again (or by pressing Escape).


# Simulate ctrl+v upon pressing $mod+x
bindsym --release $mod+x exec --no-startup-id xdotool key --clearmodifiers ctrl+v

# Take a screenshot upon pressing $mod+x (select an area)
bindsym --release $mod+x exec --no-startup-id import /tmp/latest-screenshot.png


md5 mathematica 1523e5ed52161e8bb3f55bd688e11f35

 $ doc/doxygen.warnings.report.sh -m mesh/helper



proto: precision = 3.000 usec (-18)
Listen and drop on 0 v4wildcard 0.0.0.0:123
./../lib/isc/unix/ifiter_getifaddrs.c:155: INSIST(ifa->ifa_name != ((void *)0)) failed
exiting (due to assertion failure)



== Analyse du log
newpeer: <null>->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000
fait référence à soi même: on est soi mm l'hrologe de réf cf "server 127.127.1.0" dans la config
 * \verbatim
 *                          1                   2                   3
 *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 *     +---------------+---------------+-------+-----------------------+
 *     |     Kind      |    Length     |Subtype|                       |
 *     +---------------+---------------+-------+                       |
 *     |                     Subtype-specific data                     |
 *     |                       (variable length)                       |
 *     +---------------------------------------------------------------+

 1 Jan 00:00:00 ntp_intres[2022]: receive_blocking_req_internal: pipe read No such file or directory
 est dans work_fork.c l. 236
DPRINTF(3, ("newpeer(%s): local interface currently not bound\n",
			stoa(srcadr)));	
est dans ntp_peer.c l. 865

eglibc-2.11.1/sysdeps/unix/sysv/linux/ifaddr.c
// Sinon on pourrait inclure
eglibc-2.11.1/sysdeps/unix/sysv/linux/netlinkaccess.c

Le code provoquant l'erreur suivante:
 1 Jan 00:00:00 ntpd[2022]: ./../lib/isc/unix/ifiter_ioctl.c:181: unexpected error:
 1 Jan 00:00:00 ntpd[2022]: get interface configuration: maximum buffer size exceeded
est dans unix/ifiter_ioctl.c
/*%
 * Size of buffer for SIOCGLIFCONF, in bytes.  We assume no sane system
 * will have more than a megabyte of interface configuration data.
 */
#define IFCONF_BUFSIZE_INITIAL	4096
fait appel aux ioctl (en particulier) qui sont SIOCGIFCONF

What does that mean ?
"local interface currently not bound"

http://www.commandlinefu.com/commands/view/5710/intersection-between-two-files

0.600022s 1 DceNetdb:dce_getifaddrs(): [INFO ] MATT
0.600022s 1 SimuFd:dce_socket(0x8f6680, 1, 16, 3, 0)
0.600022s 1 ProcessUtils:UtilsAllocateFd(0x8f6680)
0.600022s 1 ProcessUtils:UtilsAllocateFd(): [DEBUG] Allocated fd=5
0.600022s 1 SimuFd:dce_bind(0x8f6680, 1, 5, 0x7f82f1d2f360, 12)
0.600022s 1 SimuFd:dce_getsockname(0x8f6680, 1, 0x7f82f1d2f360, 0x7f82f1d2f1ec)
0.600022s 1 DceNetdb:netlink_request(18)
0.600022s 1 SimuFd:dce_sendto(0x8f6680, 5, 0x7f82f1d2f150, 20, 0, 0x7f82f1d2f120, 12)
0.600022s 1 SimuFd:dce_sendmsg(0x8f6680, 1, 5, 0x7f82f1d2efe0, 0)
0.600022s 1 UnixDatagramSocketFd:DoSendmsg(0x99c830, 0x8f6680)
0.600022s 1 Node:GetNDevices(0x911fe0)
0.600022s 1 Node:GetDevice(0x911fe0, 0)
0.600022s 1 Node:GetNDevices(0x911fe0)
0.600022s 1 Node:GetDevice(0x911fe0, 1)
0.600022s 1 Node:GetNDevices(0x911fe0)
0.600022s 1 Node:GetDevice(0x911fe0, 2)
0.600022s 1 Node:GetNDevices(0x911fe0)
0.600022s 1 SimuFd:dce_recvmsg(0x8f6680, nodeId=, 1,  fd=, 5,  msg=, 0x7f82f1d2f170,  flags=, 0)
0.600022s 1 UnixDatagramSocketFd:DoRecvmsg(0x99c830, 0x8f6680, flags=, 0)
0.600022s 1 UnixDatagramSocketFd:DoRecvmsg(): [WARN ] Kesako ?
0.600022s 1 UnixDatagramSocketFd:DoRecvmsg(): [WARN ] msg_controllen < 0 , is that a problem ?
0.600022s 1 SimuFd:dce_recvmsg(0x8f6680, nodeId=, 1,  fd=, 5,  msg=, 0x7f82f1d2f170,  flags=, 0)
0.600022s 1 UnixDatagramSocketFd:DoRecvmsg(0x99c830, 0x8f6680, flags=, 0)
0.600022s 1 UnixDatagramSocketFd:DoRecvmsg(): [WARN ] Kesako ?
1.6s 1 ProcessUtils:UtilsDoSignal(): [DEBUG] deliver signal=14
1.6s 1 SimuFd:dce_write(0x8f6680, 1, 1, 0x7f82e9b1b90d, 28)
1.6s 1 UnixFileFd:Write(0x8916d0, 0x8f6680, 0x7f82e9b1b90d, 28)
1.6s 1 UnixDatagramSocketFd:DoRecvmsg(): [WARN ] Empty packet
1.6s 1 DceNetdb:netlink_request(): [WARN ] read_len=-1 < 0
1.6s 1 DceNetdb:dce_getifaddrs(): [WARN ] Could not RTM_GETLINK.
1.6s 1 SimuFd:dce_close(0x8f6680, 1, 5)
1.6s 1 DceTime:dce_time(0x8f6680, 1)
1.6s 1 ProcessUtils:UtilsNodeTime(1)
1.6s 1 Node:GetWallTime(0x911fe0)
1 ClockPerfect:GetTime(0x9120f0)

\defgroup

do-release-upgrade pr maj ubuntu

// passer les defines
xrdb -D
:set aliases bu "open -t http://bugs.debian.org/"

i3-msg mark irssi

===
Netlink dissection is available in wireshark


utils.h

#define OPENED_FD_METHOD(rettype, args) OPENED_FD_METHOD_ERR (-1, rettype, args)

1 Jan 00:00:01 ntpd[2022]: ./../lib/isc/unix/ifiter_getifaddrs.c:99: unexpected error:
1 Jan 00:00:01 ntpd[2022]: getting interface addresses: getifaddrs: Invalid argument
1 Jan 00:00:01 ntp_intres[2022]: receive_blocking_req_internal: pipe read No such file or directory



========= STDOUT
 1 Jan 00:00:00 ntpd[2022]: ntpd 4.3.21@1.2483-o Mon Apr 27 16:52:03 UTC 2015 (3): Starting
 1 Jan 00:00:00 ntpd[2022]: Command line: /home/teto/ntp/ntpd/ntpd -c /tmp/ntp.conf -ddd
ntp_rlimit: STACK: 50 4k pages
ntp_rlimit: MEMLOCK: 32 MB
 1 Jan 00:00:00 ntpd[2022]: set_process_priority: Leave priority alone: priority_done is <2>
 1 Jan 00:00:00 ntpd[2022]: proto: precision = 1.000 usec (-20)
Finished Parsing!!
create_sockets(123)
move_fd: estimated max descriptors: 1024, initial socket boundary: 16
 1 Jan 00:00:00 ntpd[2022]: Listen and drop on 0 v4wildcard 0.0.0.0:123
created interface #0: fd=6, bfd=-1, name=v4wildcard, flags=0x89, ifindex=0, sin=0.0.0.0, bcast=0.0.0.0, mask=255.255.255.255, Disabled:
update_interfaces(123)
create_sockets: Total interfaces = 1
 1 Jan 00:00:00 ntpd[2022]: Listening on routing socket on fd #7 for interface updates
io_open_sockets: maxactivefd 7
configuring filegen:
	dir:	/var/NTP/ -> /var/NTP/
	fname:	loopstats -> loopstats
	type:	2 -> 2
	flag: 1 -> 81
configuring filegen:
	dir:	/var/NTP/ -> /var/NTP/
	fname:	peerstats -> peerstats
	type:	2 -> 2
	flag: 1 -> 81
configuring filegen:
	dir:	/var/NTP/ -> /var/NTP/
	fname:	clockstats -> clockstats
	type:	2 -> 2
	flag: 1 -> 81
getnetnum given 0.0.0.0, got 0.0.0.0
getnetnum given 0.0.0.0, got 0.0.0.0
restrict: op 1 addr 0.0.0.0 mask 0.0.0.0 mflags 00000000 flags 000001d0
getnetnum given 127.0.0.1, got 127.0.0.1
restrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00000000 flags 00000000
restrict: op 1 addr ::1 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00000000 flags 00000000
findexistingpeer_addr(127.127.1.0:123, NULL, 3, 0x1)
newpeer(127.127.1.0): local interface currently not bound
key_expire: at 0 associd 16467
peer_clear: at 0 next 1 associd 16467 refid INIT
event at 0 LOCAL(0) 8011 81 mobilize assoc 16467
newpeer: <null>->127.127.1.0 mode 3 vers 4 poll 6 6 flags 0x9 0x1 ttl 0 key 00000000
========= STDERR
 1 Jan 00:00:00 ntpd[2022]: Cannot set RLIMIT_MEMLOCK: Operation not permitted
 1 Jan 00:00:00 ntpd[2022]: ./../lib/isc/unix/ifiter_ioctl.c:181: unexpected error:
 1 Jan 00:00:00 ntpd[2022]: get interface configuration: maximum buffer size exceeded
 1 Jan 00:00:00 ntp_intres[2022]: receive_blocking_req_internal: pipe read No such file or directory
========= SYSLOG
receive_blocking_req_internal: pipe read No such file or directory



kod = kiss of death packet

== Comment compiler waf
The files present in the folder waflib/extras represent extensions (Waf tools) that are in a testing phase. They may be added to the Waf binary by using the --tools switch:
$ python waf-light --tools=compat15,swig,doxygen
$ ./waf-light --tools=clang_compilation_database


  --with-ns3=WITH_NS3   Specify the installed directory of ns-3-dev
Ne marche pas en fait, ne va pas chercher les headers dans le bon dossier


hi, thehajime I don't know if it's a bug but in DCE,  when you do "waf configure --with-ns3=$HOME/ns3install" , gcc still searches the include folder in /usr/local instead of "$HOME/ns3install/include"

ldd elf-cache/0/ntpd


Pour tester
utils.cc:GetTimeStamp 
PrepareDoStartProcess
dce_exit
UnixSocketFd:Setsockopt(): Unsupported setsockopt requested. level: SOL_SOCKET, optname: 35 avec 35 correspondant à SO_TIMESTAMPNS / SO_TIMESTAMP


Comment ns3 récupère le temps ?
=====






NTP
=====
La logique de détection de la précision est dans ntp_proto.c, le pb apparaît dans measure_tick_fuzz. On peut afficher un l_fp via pretty_date()

l_fp defined in ntp_fp.h . It means "long fixed point". C'est apparemment dans ntp_proto.h qu'on peut faire des choses intéressantes. La logique de get_systime est expliquée dans precision.c
Dans libntp/systime.c. On peut s'inspirer de la version dans ntpsim.c qui ajoute 200ns a chaque itération.

measure_precision
Utiliser nm pour voir les symboles

[14:33:25] Nat: this is the proposal
[14:33:26] Nat: http://pastebin.com/7YqxKY7y


Les erreurs que j'ai:

// Node, signal, XXX
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 1, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 2, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 3, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 15, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 7, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 10, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 12, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 13, 0x7f2a28dbd900, 0x7f2a28dbd9a0)
0.6s 1 SimuSignal:dce_sigaction(0x863130, 1, 14, 0x7f2a28dbd8f0, 0x7f2a28dbd990)

Program received signal SIGBUS, Bus error.
0x00007fffea375bc5 in fprintf () at ../model/libc-ns3.h:282
282	NATIVE (fprintf)

which translates sequentially, into:
SIGHUP = 1
SIGINT = 2
SIGQUIT = 3
SIGTERM = 15
SIGBUS = 7
SIGUSR1 = 10
SIGUSR2 = 12
SIGPIPE = 13 
SIGALRM	= 14

1 	SIGHUP 	Hang up—indicates that the terminal a process is using has closed. Daemons that don’t run in a terminal often respond to this signal by rereading configuration files or restarting their logging tools.
2 	SIGINT 	Interrupt—end program operation. The kernel sends this signal when you press Ctrl+C.
3 	SIGQUIT 	Quit—terminate and leave a core file for debugging purposes. Normally initiated by a user action.
6 	SIGABRT 	Abort—terminate and leave a core file for debugging purposes. Normally initiated by a debugging process or self-detected error.
9 	SIGKILL 	Kill—end program operation ungracefully; the program may not save open files, etc.
10 	SIGUSR1 	User signal 1—Effect varies from one program to another.
12 	SIGUSR2 	User signal 2—Effect varies from one program to another.
15 	SIGTERM 	Terminate—end program operation gracefully (closing open files, etc.).
18 	SIGCONT 	Continue—resume processing; undo the effect of a SIGSTOP signal.
19 	SIGSTOP 	Stop—suspend program operation, similar (but not identical) to the effect of pressing Ctrl+Z.

What I need is to implement dce_gettimeofday, 
- if (signal(SIGINT, SIGINT_handler) == SIG_ERR)

Pour accéder au node dce courant:
- Thread *current = Current ();
- GET_CURRENT_NOLOG()
Process::nodeId

ns3::NodeList::GetNode 	( 	uint32_t  	n	) 	
UtilsGetNodeId()
UtilsAdvanceTime ?

dce_gettimeofday(0x179c630, 0)

6s 1 Dce:dce_getpid(0x11a4130, 1)
0.6s 1 Dce:dce___errno_location(0x11a4130, 1)
0.6s 1 Dce:dce___errno_location(0x11a4130, 1)


=sommeprod(B9:E9;B7:E7)/somme(B7:E7)
